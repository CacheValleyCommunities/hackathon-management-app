<div class="min-h-screen bg-white">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-10 backdrop-blur-sm bg-white/95">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 tracking-tight">Account Settings</h1>
                    <p class="text-sm text-gray-500 mt-2">Manage your account preferences and data</p>
                </div>
                <a href="/" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition">
                    ← Back to Home
                </a>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Error Messages -->
        {{#if error}}
        <div class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded">
            <p class="text-red-800 font-medium">✗ {{error}}</p>
        </div>
        {{/if}}

        <!-- Success Messages -->
        {{#if success}}
        <div class="mb-6 bg-green-50 border-l-4 border-green-500 p-4 rounded">
            <p class="text-green-800 font-medium">✓ {{success}}</p>
        </div>
        {{/if}}

        <!-- Account Information -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight mb-6">Account Information</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                    <input type="email" value="{{user.email}}" disabled
                        class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-600 cursor-not-allowed">
                    <p class="text-xs text-gray-500 mt-1">Your email address cannot be changed</p>
                </div>
            </div>
        </div>

        <!-- Email Preferences -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight mb-6">Email Preferences</h2>
            <form method="POST" action="/account/settings/email-preferences" class="space-y-4">
                <div class="flex items-start gap-3">
                    <input type="checkbox" id="email_preferences" name="email_preferences" value="1"
                        {{#if user.email_preferences}}checked{{/if}}
                        class="mt-1 w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-900">
                    <div class="flex-1">
                        <label for="email_preferences" class="block text-sm font-semibold text-gray-700 mb-1">
                            Receive marketing emails
                        </label>
                        <p class="text-xs text-gray-500">
                            Currently, we only send transactional emails (login links, registration confirmations, etc.).
                            If we begin sending marketing communications in the future, you can opt-out using this setting.
                        </p>
                    </div>
                </div>
                <button type="submit"
                    class="px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white rounded-lg font-semibold transition">
                    Save Preferences
                </button>
            </form>
        </div>

        <!-- Data Export -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight mb-6">Export Your Data</h2>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                <p class="text-blue-800 text-sm mb-2">
                    <strong>About Data Export</strong>
                </p>
                <p class="text-blue-700 text-sm">
                    You can download a copy of all your personal data stored in our system. The download includes a ZIP
                    file containing:
                </p>
                <ul class="text-blue-700 text-sm list-disc list-inside mt-2 space-y-1">
                    <li>Your account information (JSON format)</li>
                    <li>Team data and project information (if applicable)</li>
                    <li>All scores you've submitted</li>
                    <li>All team images (banner, logo, and screenshots)</li>
                </ul>
            </div>
            <a href="/account/export"
                class="inline-flex items-center gap-2 px-6 py-3 bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 rounded-lg font-semibold transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Download My Data (ZIP)
            </a>
        </div>

        <!-- Account Deletion -->
        <div class="mb-12 pb-8 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 tracking-tight mb-6">Delete Account</h2>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-4">
                <p class="text-red-800 text-sm font-semibold mb-2">Warning: This action cannot be undone</p>
                <p class="text-red-700 text-sm">
                    Deleting your account will permanently remove your account information, judge assignments, and magic
                    link tokens. Your scores may be retained for historical records. If you are a team leader, team
                    ownership will be transferred.
                </p>
            </div>
            <form method="POST" action="/account/delete" id="deleteForm" class="space-y-4">
                <div>
                    <label for="confirm" class="block text-sm font-semibold text-gray-700 mb-2">
                        Type <strong>DELETE</strong> to confirm:
                    </label>
                    <input type="text" id="confirm" name="confirm" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition"
                        placeholder="Type DELETE to confirm">
                </div>
                <button type="submit"
                    class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition">
                    Delete My Account
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('deleteForm').addEventListener('submit', function(e) {
    const confirmInput = document.getElementById('confirm').value;
    if (confirmInput !== 'DELETE') {
        e.preventDefault();
        alert('Please type DELETE exactly to confirm account deletion.');
        return false;
    }
    
    if (!confirm('Are you absolutely sure you want to delete your account? This action cannot be undone.')) {
        e.preventDefault();
        return false;
    }
});
</script>

